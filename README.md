# tg-membership-gate

–¢–µ–ª–µ–≥—Ä–∞–º‚Äë–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–æ–º –≤ –∑–∞–∫—Ä—ã—Ç—ã–µ —á–∞—Ç—ã/–∫–∞–Ω–∞–ª—ã –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–º—É ID.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –°—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ —à–∞–±–ª–æ–Ω—É —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–æ–π –∏ –∫–Ω–æ–ø–∫–æ–π ¬´–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø¬ª.
- –ü—Ä–æ–≤–µ—Ä–∫–∞ ID –ø–æ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏—é –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö. –ü–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω –≤–∏–¥–∏—Ç –Ω–∞–±–æ—Ä
  –∫–Ω–æ–ø–æ–∫: –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å (–Ω–∞ —Ä–∞–∑–Ω—ã–µ —Å—Ä–æ–∫–∏), –æ—Ç–∫–ª–æ–Ω–∏—Ç—å, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤/—á–∞—Ç–æ–≤. –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è,
  –∞ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ ‚Äì —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —ç—Ç–∏—Ö —á–∞—Ç–æ–≤.
- –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ —Å–ª–µ–¥–∏—Ç –∑–∞ –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–∞ –∏ –∑–∞–±–ª–∞–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç
  –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –¢–∞–π–º–∞—É—Ç—ã –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è —Ç–∞–∫–∂–µ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–µ–π.
- –î–≤–∞ –±—ç–∫–µ–Ω–¥–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö: SQLite (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏ PostgreSQL. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `.env`.
- –ù–∞–±–æ—Ä –∞–¥–º–∏–Ω‚Äë–∫–æ–º–∞–Ω–¥: `/ban`, `/unban`, `/kick` (`/remove`), `/export_users`, `/user`.
- –í—Å–µ —Ç–µ–∫—Å—Ç—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ Jinja2‚Äë—à–∞–±–ª–æ–Ω—ã (`templates/`).

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
   ```bash
   pip install -r requirements.txt
   ```

2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)**
   - `BOT_TOKEN` ‚Äì —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç `@BotFather`.
   - `ROOT_ADMIN_ID` ‚Äì Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
   - `DB_BACKEND` ‚Äì `sqlite` –∏–ª–∏ `postgres`.
   - `SQLITE_DB_PATH` –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `PG_*` ‚Äì –ø—É—Ç—å –∫ –ë–î.
   - `ACCESS_CHATS` ‚Äì ID —á–∞—Ç–æ–≤/–∫–∞–Ω–∞–ª–æ–≤, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –Ω—É–∂–Ω–æ —É–¥–∞–ª—è—Ç—å –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –¥–æ—Å—Ç—É–ø–∞.
   - `JOIN_INVITE_LABEL_PREFIX` ‚Äì –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è —Å–æ–∑–¥–∞–≤–∞–µ–º—ã—Ö –∑–∞—è–≤–æ—á–Ω—ã—Ö —Å—Å—ã–ª–æ–∫.

   –ü—Ä–∏–º–µ—Ä `.env`:
   ```env
   BOT_TOKEN=123456:ABCDEF
   ROOT_ADMIN_ID=123456789
   ACCESS_CHATS=-1001111111,-1002222222
   DB_BACKEND=sqlite
   SQLITE_DB_PATH=./db.sqlite3
   # –î–ª—è PostgreSQL –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ DB_BACKEND=postgres –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ PG_*
   ```


3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`config/`)**
   - `ui_config.yaml` ‚Äì —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π, —Ç–µ–∫—Å—Ç—ã –∫–Ω–æ–ø–æ–∫.
   - `membership.yaml` ‚Äì –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å ID, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω‚Äë–∫–Ω–æ–ø–æ–∫,
     –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏—Å—Ç–µ—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∏ —Ç–∞–π–º–∞—É—Ç–∞ —Å–µ—Å—Å–∏–∏.

4. **–ó–∞–ø—É—Å–∫**
   ```bash
   python telegram_bot.py
   ```

## üåê Localized images

- –°–ª–æ–∂–∏—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–æ —è–∑—ã–∫–∞–º: `assets/<lang>/start.jpg`, `assets/<lang>/final.jpg`.
- –í `config/ui_config.yaml` —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç–∏ –∏–ª–∏ `file_id` –¥–ª—è —Å–µ–∫—Ü–∏–π `start`,
  `language_prompt` –∏ `post_join`.
- –ü–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É –∫–∞—Ä—Ç–∏–Ω–æ–∫ —á–µ—Ä–µ–∑ `enabled_image` (`start` –∏
  `post_join` –≤–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, `language_prompt` ‚Äî –æ—Ç–∫–ª—é—á—ë–Ω).
- –ë–æ—Ç –∫–µ—à–∏—Ä—É–µ—Ç `file_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `media_cache` –∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–≥–æ.
  –ü—Ä–∏ –∑–∞–º–µ–Ω–µ —Ñ–∞–π–ª–∞ —Ö–µ—à (`sha256`) –º–µ–Ω—è–µ—Ç—Å—è ‚Äî –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–æ—Ç–ø—Ä–∞–≤–∏—Ç—Å—è –∏
  –∫–µ—à –æ–±–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã; –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç.
- –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å—å –ø—Ä–µ–≤—ã—à–∞–µ—Ç 1024 —Å–∏–º–≤–æ–ª–∞, —Ñ–æ—Ç–æ –ø—Ä–∏–¥—ë—Ç –±–µ–∑ –ø–æ–¥–ø–∏—Å–∏, –∞ —Ç–µ–∫—Å—Ç ‚Äî
  –æ—Ç–¥–µ–ª—å–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

## üîÑ –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–º–∞–Ω–¥—É `/start`.
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∫–Ω–æ–ø–∫—É ¬´–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø¬ª.
3. –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç —Å–≤–æ–π ID.
4. –ï—Å–ª–∏ ID –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –≤ –ë–î ‚Äì –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –∑–∞–∫—Ä—ã—Ç—ã–µ —á–∞—Ç—ã.
5. –ï—Å–ª–∏ ID –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω ‚Äì –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
   —Å inline‚Äë–∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è.
6. –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è. –ü—Ä–∏ –æ—Ç–∫–∞–∑–µ/–±–∞–Ω–µ ‚Äì —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
7. –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Å—Ä–æ–∫–∞ –∏ —É–¥–∞–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   –∏–∑ —á–∞—Ç–æ–≤, –∫–æ–≥–¥–∞ —Å—Ä–æ–∫ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è.

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

- `/ban <ID>` ‚Äî –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —É–¥–∞–ª–∏—Ç—å –∏–∑ –∫–∞–Ω–∞–ª–æ–≤.
- `/unban <ID>` ‚Äî —Å–Ω—è—Ç—å –±–∞–Ω.
- `/kick <ID>` ‚Äî —É–¥–∞–ª–∏—Ç—å –∏–∑ –∫–∞–Ω–∞–ª–æ–≤.
- `/remove <ID>` ‚Äî —Å–∏–Ω–æ–Ω–∏–º `/kick`.
- `/export_users [all|confirmed|unconfirmed|banned]` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ CSV.
- `/user <ID>` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤–µ–¥–µ–Ω–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.

## üß™ –¢–µ—Å—Ç—ã

```bash
pytest
```

## üóÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π

- `modules/` ‚Äì –∫–æ–¥ –±–æ—Ç–∞ (—Ä–æ—É—Ç–µ—Ä, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –ë–î, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∏).
- `templates/` ‚Äì —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π.
- `schema/` ‚Äì SQL‚Äë—Å—Ö–µ–º—ã –¥–ª—è SQLite –∏ PostgreSQL.
- `config/` ‚Äì YAML‚Äë–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ –ø—Ä–∞–≤–∏–ª –¥–æ—Å—Ç—É–ø–∞.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.

